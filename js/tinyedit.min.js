!function(a,b){"use strict";function c(a){return o+a}function d(){var b=a.documentElement,c=a.body;return{x:c.scrollLeft+b.scrollLeft,y:c.scrollTop+b.scrollTop}}function e(a,b){var c=d();return{x:a-c.x,y:b-c.y}}function f(b,c,d){var f,g,h,i=e(c,d);if(c=i.x,d=i.y,a.caretPositionFromPoint)f=a.caretPositionFromPoint(c,d),g=f.offsetNode,h=f.offset;else{if(!a.caretRangeFromPoint)return calcTextOffsetFromPosition(b,c,d);f=a.caretRangeFromPoint(c,d),g=f.startContainer,h=f.startOffset}return{textNode:g,offset:h}}function g(a){for(var b;b=a.parentNode;){if(h(b,"container"))return a;a=b}return null}function h(a,b){return a&&a.classList&&a.classList.contains(c(b))}function i(a,b){return a&&a.nodeName.toLowerCase()===b}function j(b,d,e){var f=a.createElement(b);if(d&&(d=d.map(function(a){return c(a)}),f.classList.add.apply(f.classList,d)),e)for(var g in e)f.setAttribute(g,e[g]);return f}function k(a){var b=j("div"),c=j("div");return c.innerHTML=a,b.appendChild(c),b}function l(a,b){for(var c=Array.prototype.slice.call(arguments,1),d=0;d<c.length;d++){var e=c[d];for(var f in e)e.hasOwnProperty(f)&&null!==e[f]&&void 0!==e[f]&&(a[f]=e[f])}return a}function m(a,d){var e=this;d=l({tabWidth:4,tabStyle:"hard",textarea:null,firstLineNumber:1,lineBreak:"\n",editable:!0},d),this.options=d,a.style.tabSize=d.tabWidth,this.deferred={funcs:[],timeout:null,run:function(a){var c=this;this.funcs.push(a),this.timeout||(this.timeout=b.setTimeout(function(){for(var a=0;a<c.funcs.length;a++)c.funcs[a]();c.funcs=[],c.timeout=null},0))}},this.cursors={list:[],remove:function(a){var b=this.list.indexOf(a);b>=0&&this.list.splice(b,1)},removeAll:function(){this.inputElement&&this.inputElement.removeEventListener("blur",this.inputBlur),this.list.forEach(function(a){var b=a.parentNode;if(b){for(b.removeChild(a);!i(b,"div");)b=b.parentNode;b.normalize()}}),this.list=[]},create:function(){var a=j("span",["cursor","blink"]);return this.list.push(a),a},inputBlur:function(){e.cursors.removeAll()},createInputElement:function(){if(!this.inputElement){var a=j("textarea",["input"],{wrap:"off",autocapitalize:"off",spellcheck:"false"});this.inputElement=a}return this.inputElement},activateForInput:function(a){var b=this.createInputElement();a.appendChild(b),b.focus(),b.addEventListener("blur",this.inputBlur)},resetBlink:function(){var a=this;this.list.forEach(function(a){a.classList.remove(c("blink"))}),deferred.run(function(){a.list.forEach(function(a){a.classList.add(c("blink"))})})}},this.lines={element:null},this.gutter={element:null,update:function(){for(var a=this.element,b=a.childNodes.length,c=e.lines.element.childNodes.length;c>b;){var f=j("div");f.textContent=d.firstLineNumber+b,a.appendChild(f),b++}for(;b>c;)a.removeChild(a.lastChild),b--}},this.value=function(a){var b=this;a=l({tabWidth:b.options.tabWidth,tabStyle:b.options.tabStyle,lineBreak:b.options.lineBreak},a);for(var c=[],d=this.lines.element.children,e=0;e<d.length;e++)c.push(d[e].textContent);return c.join(a.lineBreak)};var f,g=j("div",["content"]),h=j("div",["gutter"]),k=j("div",["content-inner","container"]),m=j("div",["gutter-inner","container"]);g.appendChild(k),h.appendChild(m),d.textarea?(f=d.textarea.value,textarea.style.display="none"):f=a.textContent,f=f.split(/\r?\n/m),f.forEach(function(a){var b=e.createLineElementFromRawLineContent(a);k.appendChild(b)}),this.lines.element=k,this.gutter.element=m,this.gutter.update(),a.innerHTML="",a.appendChild(h),a.appendChild(g),d.editable&&a.addEventListener("mousedown",function(a){e.handleMouseDownEvent(a)})}var n="tinyedit",o=n+"-",p=n+(1e7*Math.random()|0),q=m.prototype;q.createLineElementFromRawLineContent=function(a){return a=a.replace(/\s+$/g,""),a=a.replace(/\t/g,'<span class="'+c("tab")+'">	</span>'),k(a)},q.handleGutterClick=function(a,b){},q.handleTextClick=function(b,c){this.cursors.removeAll();var d=this,e=c.pageX,g=c.pageY,j=f(b,e,g);if(j){var k=j.textNode;if(h(k.parentNode,"tab")){var l=k.parentNode,m=l.getBoundingClientRect();d.cursors.removeAll();var n,o=d.cursors.create();return n=e>=m.left+.5*m.width?l.nextSibling:l,l.parentNode.insertBefore(o,n),void d.cursors.activateForInput(o)}h(k,"cursor")&&(k=k.nextSibling?k.nextSibling:k.parentNode.insertBefore(a.createTextNode(""),k),j.textNode=k);var o=d.cursors.create(),p=j.textNode;if(i(p,"div"))p.appendChild(o);else if(0==j.offset)p.parentNode.insertBefore(o,p);else if(j.offset==j.textNode.nodeValue.length)p.parentNode.insertBefore(o,p.nextSibling);else{var q=j.textNode.splitText(j.offset);q.parentNode.insertBefore(o,q)}d.cursors.activateForInput(o)}},q.handleMouseDownEvent=function(a){var b=this,c=a.target;if(a.preventDefault(),c=g(c),!c)return null;var d=c.parentNode;h(d,"content-inner")?(c=c.querySelector("div"),b.handleTextClick(c,a)):h(d,"gutter-inner")&&b.handleGutterClick(c,a)},window.TinyEdit=function(a,b){if(!a||!a.parentNode||!a.ownerDocument)return null;if(!a[p]){var c=new m(a,b);a[p]=c}return a[p]}}(document,window);
//# sourceMappingURL=tinyedit.min.js.map