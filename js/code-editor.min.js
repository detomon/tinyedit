!function($,d,w){function positionFromRelativePosition(a,b){return a-=d.body.scrollLeft+de.scrollLeft,b-=d.body.scrollTop+de.scrollTop,{x:a,y:b}}function textOffsetFromPosition(a,b,c){var e,f,g,h=positionFromRelativePosition(b,c);if(b=h.x,c=h.y,d.caretPositionFromPoint)e=d.caretPositionFromPoint(b,c),f=e.offsetNode,g=e.offset;else{if(!d.caretRangeFromPoint)return calcTextOffsetFromPosition(a,b,c);e=d.caretRangeFromPoint(b,c),f=e.startContainer,g=e.startOffset}return{textNode:f,offset:g}}function fragmentContainingOffset(a,b){for(var c=a.firstChild;c;){if(c.textContent){if(b<c.textContent.length)break;b-=c.textContent.length}c=c.nextSibling}return{fragment:c,offset:b}}function insertElementAtOffset(a,b,c){var e,f,g=fragmentContainingOffset(b,c),h=g.fragment;h?(e=h.textContent,h.textContent=e.slice(0,g.offset),f=d.createTextNode(e.slice(g.offset)),h.parentElement.insertBefore(f,h.nextSibling),h.parentElement.insertBefore(a,f)):b.appendChild(a)}function calcTextOffsetFromPosition(a,b,c){var e=d.createElement("span");e.style.width="1px",e.style.height="1em",e.style.display="inline-block";for(var f,g,h=lineLength(a),i=[0,h+1],j=0;i[0]<i[1];){var j=(i[0]+i[1])/2|0;e.previousSibling&&e.nextSibling&&e.previousSibling.textContent&&e.nextSibling.textContent&&(e.previousSibling.textContent+=e.nextSibling.textContent,removeElement(e.nextSibling),removeElement(e)),insertElementAtOffset(e,a,j),f=e.getBoundingClientRect(),f.left<b?i[0]=j+1:i[1]=j}return e.previousSibling&&e.nextSibling&&e.previousSibling.textContent&&e.nextSibling.textContent&&(e.previousSibling.textContent+=e.nextSibling.textContent,removeElement(e.nextSibling)),g=prevTextSibling(e),removeElement(e),{textNode:g,offset:i[0]}}function lineLength(a){var b,c=0;for(b=a.firstChild;b;b=b.nextSibling)c+=b.textContent.length;return c}function absoluteCharacterOffsetInLine(a,b){var c=b;for(a=a.previousSibling;a;)c+=a.textContent.length,a=a.previousSibling;return c}function deleteCharacter(a,b){if(a=b>0?a.nextSibling:a.previousSibling){var c=a.textContent,d=b>0?[1]:[0,c.length-1];c=c.substring.apply(c,d),c.length?a.textContent=c:removeElement(a)}}function nextTextSibling(a){var b=a.nextSibling;return b||(b=d.createTextNode(""),a.parentElement.insertBefore(b,a.nextSibling)),b}function prevTextSibling(a){var b=a.previousSibling;return b||(b=d.createTextNode(""),a.parentElement.insertBefore(b,a)),b}function insertCharacter(a,b){prevTextSibling(a).textContent+=b}function insertTab(a){var b=d.createElement("span");b.textContent="    ",b.className="code-editor-tab",a.parentElement.insertBefore(b,a)}function moveCursorHorizontal(a,b){if(b>0){var c=a.nextSibling;if(c){var d=c.textContent.slice(0,1);c.textContent=c.textContent.slice(1),prevTextSibling(a).textContent+=d}}else{var c=nextTextSibling(a),e=a.previousSibling;if(e){var d=e.textContent.slice(-1);e.textContent=e.textContent.slice(0,-1),c.textContent=d+c.textContent}}}function removeElement(a){a&&a.parentElement&&a.parentElement.removeChild(a)}function removeElementMerge(a){a&&a.parentElement&&(a.previousSibling&&a.nextSibling&&a.previousSibling.textContent&&a.nextSibling.textContent&&(a.previousSibling.textContent+=a.nextSibling.textContent,removeElement(a.nextSibling)),removeElement(a))}function indexOfObject(a,b){var c,d=-1;for(c=0;c<a.length;c++)if(a[c]==b){d=c;break}return d}function addCursor(a){indexOfObject(cursors,a)<0&&cursors.push(a)}function removeCursor(a){var b=indexOfObject(cursors,a);b>=0&&cursors.splice(b,1)}function addCursorFromEvent(content,gutter,e){var line=e.target;for(e.preventDefault();line.parentElement&&line.parentElement!=content;)line=line.parentElement;if(line.parentElement==content){var inner=line.querySelector("div"),offset=textOffsetFromPosition(inner,e.pageX,e.pageY);if(offset.offset=absoluteCharacterOffsetInLine(offset.textNode,offset.offset),offset.textNode){var textarea,cursorSpan=(inner.textContent,d.createElement("span"));with(cursorSpan.className="code-editor-cursor code-editor-blink",insertElementAtOffset(cursorSpan,inner,offset.offset),addCursor(cursorSpan),textarea=d.createElement("textarea"))setAttribute("wrap","off"),setAttribute("autocapitalize","off"),setAttribute("spellcheck","false"),className="code-editor-input",addEventListener("blur",function(){try{removeElementMerge(cursorSpan),removeCursor(cursorSpan),cursorSpan=null}catch(a){}});cursorSpan.appendChild(textarea),textarea.addEventListener("keydown",function(a){var b=textarea.value,c=a.keyCode;8==c?(a.preventDefault(),textarea.value="",deleteCharacter(cursorSpan,-1)):46==c?(a.preventDefault(),textarea.value="",deleteCharacter(cursorSpan,1)):9==c?(insertTab(cursorSpan),a.preventDefault(),textarea.value=""):13==c?(a.preventDefault(),textarea.value=""):37==c?moveCursorHorizontal(cursorSpan,-1):38==c||(39==c?moveCursorHorizontal(cursorSpan,1):40==c||setTimeout(function(){textarea.value!=b&&(insertCharacter(cursorSpan,textarea.value),textarea.value="")}))}),textarea.focus(),line.classList.add("highlighted")}}else line.parentElement==gutter}var de=d.documentElement,cursors=[];$(function(){$(".code-editor").each(function(){var a=d.getElementById("source").value;a=a.split(/\r?\n/m);for(var b=this.querySelector(".code-editor-gutter"),c=this.querySelector(".code-editor-content"),e=0;e<a.length;e++){var f=d.createElement("div"),g=d.createElement("div");f.appendChild(g),g.textContent=a[e],c.appendChild(f);var h=d.createElement("div");h.textContent=e+1,b.appendChild(h)}$(this).on("mousedown",function(a){addCursorFromEvent(c,b,a)})})})}(u,document,window);
//# sourceMappingURL=code-editor.min.js.map